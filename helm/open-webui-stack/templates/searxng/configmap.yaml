{{- if .Values.searxng.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "open-webui-stack.searxng.fullname" . }}-config
  labels:
    {{- include "open-webui-stack.searxng.labels" . | nindent 4 }}
data:
  settings.yml: |
    use_default_settings: true

    general:
      debug: false
      instance_name: {{ .Values.searxng.config.instanceName | quote }}

    search:
      safe_search: {{ .Values.searxng.config.safeSearch }}
      autocomplete: ""
      default_lang: "auto"
      formats:
        - html
        - json

    server:
      port: 8080
      bind_address: "0.0.0.0"
      secret_key: "${SEARXNG_SECRET_KEY}"
      limiter: false

    outgoing:
      request_timeout: 5.0
      max_request_timeout: 10.0
      pool_connections: 100
      pool_maxsize: 20
      enable_http2: true

    # Domain filtering for quality results
    hostnames:
      remove:
        # Chinese domains
        - '.*\.cn$'
        - '(.*\.)?baidu\.com$'
        - '(.*\.)?zhihu\.com$'
        - '(.*\.)?qq\.com$'

        # Social media (low signal for RAG)
        - '(.*\.)?facebook\.com$'
        - '(.*\.)?twitter\.com$'
        - '(.*\.)?x\.com$'
        - '(.*\.)?instagram\.com$'
        - '(.*\.)?tiktok\.com$'
        - '(.*\.)?pinterest\.[a-z]+$'

        # Low quality content farms
        - '(.*\.)?medium\.com$'
        - '(.*\.)?quora\.com$'
        - '.*\.xyz$'
        - '.*\.tk$'

      high_priority:
        - '(.*\.)?wikipedia\.org$'
        - '(.*\.)?github\.com$'
        - '.*\.edu$'
        - '.*\.gov$'
        - '.*\.gov\.nl$'
        - '(.*\.)?rijksoverheid\.nl$'
        - '(.*\.)?overheid\.nl$'

    engines:
      - name: duckduckgo
        engine: duckduckgo
        weight: 1.4
        shortcut: ddg

      - name: brave
        engine: brave
        weight: 1.3
        shortcut: br

      - name: qwant
        engine: qwant
        weight: 1.2
        shortcut: qw

      - name: wikipedia
        engine: wikipedia
        weight: 1.3
        shortcut: wp
{{- end }}
