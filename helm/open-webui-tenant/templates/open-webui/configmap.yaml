{{- if .Values.openWebui.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "open-webui-tenant.openWebui.fullname" . }}-config
  labels:
    {{- include "open-webui-tenant.openWebui.labels" . | nindent 4 }}
data:
  # Deployment
  ENV: {{ .Values.openWebui.config.env | quote }}
  ENABLE_PERSISTENT_CONFIG: {{ .Values.openWebui.config.enablePersistentConfig | quote }}
  RESET_CONFIG_ON_START: {{ .Values.openWebui.config.resetConfigOnStart | quote }}
  WEBUI_NAME: {{ .Values.openWebui.config.webuiName | quote }}
  CORS_ALLOW_ORIGIN: {{ .Values.openWebui.config.corsAllowOrigin | quote }}

  # Admin
  OPENWEBUI_ADMIN_EMAIL: {{ .Values.openWebui.config.adminEmail | quote }}
  OPENWEBUI_ADMIN_NAME: {{ .Values.openWebui.config.adminName | quote }}

  # Locale
  DEFAULT_LOCALE: {{ .Values.openWebui.config.defaultLocale | quote }}

  # Authentication
  WEBUI_AUTH: {{ .Values.openWebui.config.webuiAuth | quote }}
  ENABLE_SIGNUP: {{ .Values.openWebui.config.enableSignup | quote }}
  ENABLE_LOGIN_FORM: {{ .Values.openWebui.config.enableLoginForm | quote }}
  ENABLE_INITIAL_ADMIN_SIGNUP: {{ .Values.openWebui.config.enableInitialAdminSignup | quote }}
  DEFAULT_USER_ROLE: {{ .Values.openWebui.config.defaultUserRole | quote }}
  ENABLE_OAUTH_SIGNUP: {{ .Values.openWebui.config.enableOauthSignup | quote }}
  OAUTH_MERGE_ACCOUNTS_BY_EMAIL: {{ .Values.openWebui.config.oauthMergeAccountsByEmail | quote }}
  ENABLE_PASSWORD_AUTH: {{ .Values.openWebui.config.enablePasswordAuth | quote }}
  JWT_EXPIRES_IN: {{ .Values.openWebui.config.jwtExpiresIn | quote }}

  # Microsoft OAuth / EntraID SSO
  {{- if .Values.openWebui.config.microsoftClientId }}
  MICROSOFT_CLIENT_ID: {{ .Values.openWebui.config.microsoftClientId | quote }}
  MICROSOFT_CLIENT_TENANT_ID: {{ .Values.openWebui.config.microsoftClientTenantId | quote }}
  MICROSOFT_REDIRECT_URI: {{ .Values.openWebui.config.microsoftRedirectUri | quote }}
  MICROSOFT_OAUTH_SCOPE: {{ .Values.openWebui.config.microsoftOauthScope | quote }}
  {{- end }}
  {{- if .Values.openWebui.config.openidProviderUrl }}
  OPENID_PROVIDER_URL: {{ .Values.openWebui.config.openidProviderUrl | quote }}
  {{- end }}
  {{- if .Values.openWebui.config.oauthAllowedDomains }}
  OAUTH_ALLOWED_DOMAINS: {{ .Values.openWebui.config.oauthAllowedDomains | quote }}
  {{- end }}

  # LLM Providers
  ENABLE_OLLAMA_API: {{ .Values.openWebui.config.enableOllamaApi | quote }}
  OPENAI_API_BASE_URL: {{ .Values.openWebui.config.openaiApiBaseUrl | quote }}
  {{- if .Values.openWebui.config.openaiApiConfigs }}
  OPENAI_API_CONFIGS: {{ .Values.openWebui.config.openaiApiConfigs | toJson | quote }}
  {{- end }}

  # Vector Database (Weaviate) - local to tenant namespace
  VECTOR_DB: {{ .Values.openWebui.config.vectorDb | quote }}
  WEAVIATE_HTTP_HOST: {{ include "open-webui-tenant.weaviate.fullname" . }}
  WEAVIATE_HTTP_PORT: {{ .Values.openWebui.config.weaviateHttpPort | quote }}
  WEAVIATE_GRPC_PORT: {{ .Values.openWebui.config.weaviateGrpcPort | quote }}
  WEAVIATE_WEB_SEARCH_TTL_MINUTES: {{ .Values.openWebui.config.weaviateWebSearchTtlMinutes | quote }}

  # Database (PostgreSQL) - local to tenant namespace
  DATABASE_TYPE: {{ .Values.openWebui.config.databaseType | quote }}
  DATABASE_USER: {{ .Values.openWebui.config.databaseUser | quote }}
  DATABASE_HOST: {{ include "open-webui-tenant.postgres.fullname" . }}
  DATABASE_PORT: {{ .Values.openWebui.config.databasePort | quote }}
  DATABASE_NAME: {{ .Values.openWebui.config.databaseName | quote }}

  # RAG Embeddings
  RAG_EMBEDDING_ENGINE: {{ .Values.openWebui.config.ragEmbeddingEngine | quote }}
  RAG_EMBEDDING_MODEL: {{ .Values.openWebui.config.ragEmbeddingModel | quote }}
  {{- if .Values.openWebui.config.ragOpenaiApiBaseUrl }}
  RAG_OPENAI_API_BASE_URL: {{ .Values.openWebui.config.ragOpenaiApiBaseUrl | quote }}
  {{- end }}
  RAG_EMBEDDING_BATCH_SIZE: {{ .Values.openWebui.config.ragEmbeddingBatchSize | quote }}
  RAG_TOP_K: {{ .Values.openWebui.config.ragTopK | quote }}
  RAG_TOP_K_RERANKER: {{ .Values.openWebui.config.ragTopKReranker | quote }}
  RAG_RELEVANCE_THRESHOLD: {{ .Values.openWebui.config.ragRelevanceThreshold | quote }}
  CHUNK_SIZE: {{ .Values.openWebui.config.chunkSize | quote }}
  CHUNK_OVERLAP: {{ .Values.openWebui.config.chunkOverlap | quote }}
  RAG_HYBRID_BM25_WEIGHT: {{ .Values.openWebui.config.ragHybridBm25Weight | quote }}
  ENABLE_RAG_HYBRID_SEARCH: {{ .Values.openWebui.config.enableRagHybridSearch | quote }}
  RAG_ALLOWED_FILE_EXTENSIONS: {{ .Values.openWebui.config.ragAllowedFileExtensions | quote }}

  # File Processing
  FILE_PROCESSING_MAX_CONCURRENT: {{ .Values.openWebui.config.fileProcessingMaxConcurrent | quote }}

  # Content Extraction & Reranking (via shared services)
  CONTENT_EXTRACTION_ENGINE: {{ .Values.openWebui.config.contentExtractionEngine | quote }}
  RAG_RERANKING_ENGINE: {{ .Values.openWebui.config.ragRerankingEngine | quote }}
  RAG_EXTERNAL_RERANKER_URL: "{{ include "open-webui-tenant.sharedServices.rerankerUrl" . }}/v1/rerank"
  EXTERNAL_DOCUMENT_LOADER_URL: {{ include "open-webui-tenant.sharedServices.gatewayUrl" . | quote }}

  # Web Search (via shared Gateway)
  ENABLE_WEB_SEARCH: {{ .Values.openWebui.config.enableWebSearch | quote }}
  WEB_SEARCH_ENGINE: {{ .Values.openWebui.config.webSearchEngine | quote }}
  SEARXNG_LANGUAGE: {{ .Values.openWebui.config.searxngLanguage | quote }}
  WEB_SEARCH_RESULT_COUNT: {{ .Values.openWebui.config.webSearchResultCount | quote }}
  ENABLE_WEB_LOADER_SSL_VERIFICATION: {{ .Values.openWebui.config.enableWebLoaderSslVerification | quote }}
  WEB_LOADER_ENGINE: {{ .Values.openWebui.config.webLoaderEngine | quote }}
  SEARXNG_QUERY_URL: "{{ include "open-webui-tenant.sharedServices.gatewayUrl" . }}/search"
  EXTERNAL_WEB_LOADER_URL: "{{ include "open-webui-tenant.sharedServices.gatewayUrl" . }}/extract"

  # Feature Flags
  FEATURE_CHAT_CONTROLS: {{ .Values.openWebui.config.featureChatControls | quote }}
  FEATURE_CAPTURE: {{ .Values.openWebui.config.featureCapture | quote }}
  FEATURE_ARTIFACTS: {{ .Values.openWebui.config.featureArtifacts | quote }}
  FEATURE_PLAYGROUND: {{ .Values.openWebui.config.featurePlayground | quote }}
  FEATURE_CHAT_OVERVIEW: {{ .Values.openWebui.config.featureChatOverview | quote }}
  FEATURE_NOTES_AI_CONTROLS: {{ .Values.openWebui.config.featureNotesAiControls | quote }}
  FEATURE_VOICE: {{ .Values.openWebui.config.featureVoice | quote }}
  FEATURE_CHANGELOG: {{ .Values.openWebui.config.featureChangelog | quote }}
  FEATURE_SYSTEM_PROMPT: {{ .Values.openWebui.config.featureSystemPrompt | quote }}
  FEATURE_MODELS: {{ .Values.openWebui.config.featureModels | quote }}
  FEATURE_KNOWLEDGE: {{ .Values.openWebui.config.featureKnowledge | quote }}
  FEATURE_PROMPTS: {{ .Values.openWebui.config.featurePrompts | quote }}
  FEATURE_TOOLS: {{ .Values.openWebui.config.featureTools | quote }}
  FEATURE_ADMIN_EVALUATIONS: {{ .Values.openWebui.config.featureAdminEvaluations | quote }}
  FEATURE_ADMIN_FUNCTIONS: {{ .Values.openWebui.config.featureAdminFunctions | quote }}
  FEATURE_ADMIN_SETTINGS: {{ .Values.openWebui.config.featureAdminSettings | quote }}
  FEATURE_ADMIN_SETTINGS_TABS: {{ .Values.openWebui.config.featureAdminSettingsTabs | quote }}
  FEATURE_CHAT_CONTROLS_SECTIONS: {{ .Values.openWebui.config.featureChatControlsSections | quote }}

  # Notes
  ENABLE_NOTES: {{ .Values.openWebui.config.enableNotes | quote }}
  USER_PERMISSIONS_FEATURES_NOTES: {{ .Values.openWebui.config.userPermissionsFeaturesNotes | quote }}

  # Knowledge
  USER_PERMISSIONS_WORKSPACE_KNOWLEDGE_ACCESS: {{ .Values.openWebui.config.userPermissionsWorkspaceKnowledgeAccess | quote }}

  # Code Execution
  ENABLE_CODE_INTERPRETER: {{ .Values.openWebui.config.enableCodeInterpreter | quote }}
  ENABLE_CODE_EXECUTION: {{ .Values.openWebui.config.enableCodeExecution | quote }}
  USER_PERMISSIONS_FEATURES_CODE_INTERPRETER: {{ .Values.openWebui.config.userPermissionsFeaturesCodeInterpreter | quote }}

  # MCP
  ENABLE_DIRECT_CONNECTIONS: {{ .Values.openWebui.config.enableDirectConnections | quote }}
  USER_PERMISSIONS_FEATURES_DIRECT_TOOL_SERVERS: {{ .Values.openWebui.config.userPermissionsFeaturesDirectToolServers | quote }}

  # Audio
  USER_PERMISSIONS_CHAT_TTS: {{ .Values.openWebui.config.userPermissionsChatTts | quote }}
  USER_PERMISSIONS_CHAT_STT: {{ .Values.openWebui.config.userPermissionsChatStt | quote }}
  USER_PERMISSIONS_CHAT_CALL: {{ .Values.openWebui.config.userPermissionsChatCall | quote }}

  # Workspace
  USER_PERMISSIONS_WORKSPACE_MODELS_ACCESS: {{ .Values.openWebui.config.userPermissionsWorkspaceModelsAccess | quote }}
  USER_PERMISSIONS_WORKSPACE_PROMPTS_ACCESS: {{ .Values.openWebui.config.userPermissionsWorkspacePromptsAccess | quote }}
  USER_PERMISSIONS_WORKSPACE_TOOLS_ACCESS: {{ .Values.openWebui.config.userPermissionsWorkspaceToolsAccess | quote }}

  # Workspace Public Sharing (allow users to share with all tenant users)
  USER_PERMISSIONS_WORKSPACE_MODELS_ALLOW_PUBLIC_SHARING: {{ .Values.openWebui.config.userPermissionsWorkspaceModelsAllowPublicSharing | quote }}
  USER_PERMISSIONS_WORKSPACE_KNOWLEDGE_ALLOW_PUBLIC_SHARING: {{ .Values.openWebui.config.userPermissionsWorkspaceKnowledgeAllowPublicSharing | quote }}
  USER_PERMISSIONS_WORKSPACE_PROMPTS_ALLOW_PUBLIC_SHARING: {{ .Values.openWebui.config.userPermissionsWorkspacePromptsAllowPublicSharing | quote }}
  USER_PERMISSIONS_WORKSPACE_TOOLS_ALLOW_PUBLIC_SHARING: {{ .Values.openWebui.config.userPermissionsWorkspaceToolsAllowPublicSharing | quote }}
  USER_PERMISSIONS_NOTES_ALLOW_PUBLIC_SHARING: {{ .Values.openWebui.config.userPermissionsNotesAllowPublicSharing | quote }}

  # UI
  ENABLE_FOLDERS: {{ .Values.openWebui.config.enableFolders | quote }}
  USER_PERMISSIONS_FEATURES_FOLDERS: {{ .Values.openWebui.config.userPermissionsFeaturesFolders | quote }}
  ENABLE_CHANNELS: {{ .Values.openWebui.config.enableChannels | quote }}
  USER_PERMISSIONS_FEATURES_CHANNELS: {{ .Values.openWebui.config.userPermissionsFeaturesChannels | quote }}
  ENABLE_COMMUNITY_SHARING: {{ .Values.openWebui.config.enableCommunitySharing | quote }}
  ENABLE_MESSAGE_RATING: {{ .Values.openWebui.config.enableMessageRating | quote }}
  ENABLE_USER_WEBHOOKS: {{ .Values.openWebui.config.enableUserWebhooks | quote }}
  ENABLE_AUTOCOMPLETE_GENERATION: {{ .Values.openWebui.config.enableAutocompleteGeneration | quote }}
  ENABLE_FOLLOW_UP_GENERATION: {{ .Values.openWebui.config.enableFollowUpGeneration | quote }}
  ENABLE_TITLE_GENERATION: {{ .Values.openWebui.config.enableTitleGeneration | quote }}
  ENABLE_TAGS_GENERATION: {{ .Values.openWebui.config.enableTagsGeneration | quote }}
  ENABLE_SEARCH_QUERY_GENERATION: {{ .Values.openWebui.config.enableSearchQueryGeneration | quote }}
  ENABLE_RETRIEVAL_QUERY_GENERATION: {{ .Values.openWebui.config.enableRetrievalQueryGeneration | quote }}

  # Chat Permissions
  USER_PERMISSIONS_CHAT_CONTROLS: {{ .Values.openWebui.config.userPermissionsChatControls | quote }}
  USER_PERMISSIONS_CHAT_VALVES: {{ .Values.openWebui.config.userPermissionsChatValves | quote }}
  USER_PERMISSIONS_CHAT_SYSTEM_PROMPT: {{ .Values.openWebui.config.userPermissionsChatSystemPrompt | quote }}
  USER_PERMISSIONS_CHAT_PARAMS: {{ .Values.openWebui.config.userPermissionsChatParams | quote }}
  USER_PERMISSIONS_CHAT_FILE_UPLOAD: {{ .Values.openWebui.config.userPermissionsChatFileUpload | quote }}
  USER_PERMISSIONS_CHAT_DELETE: {{ .Values.openWebui.config.userPermissionsChatDelete | quote }}
  USER_PERMISSIONS_CHAT_DELETE_MESSAGE: {{ .Values.openWebui.config.userPermissionsChatDeleteMessage | quote }}
  USER_PERMISSIONS_CHAT_EDIT: {{ .Values.openWebui.config.userPermissionsChatEdit | quote }}
  USER_PERMISSIONS_CHAT_SHARE: {{ .Values.openWebui.config.userPermissionsChatShare | quote }}
  USER_PERMISSIONS_CHAT_EXPORT: {{ .Values.openWebui.config.userPermissionsChatExport | quote }}
  USER_PERMISSIONS_CHAT_CONTINUE_RESPONSE: {{ .Values.openWebui.config.userPermissionsChatContinueResponse | quote }}
  USER_PERMISSIONS_CHAT_REGENERATE_RESPONSE: {{ .Values.openWebui.config.userPermissionsChatRegenerateResponse | quote }}
  USER_PERMISSIONS_CHAT_RATE_RESPONSE: {{ .Values.openWebui.config.userPermissionsChatRateResponse | quote }}
  USER_PERMISSIONS_CHAT_MULTIPLE_MODELS: {{ .Values.openWebui.config.userPermissionsChatMultipleModels | quote }}
  USER_PERMISSIONS_CHAT_TEMPORARY: {{ .Values.openWebui.config.userPermissionsChatTemporary | quote }}
  USER_PERMISSIONS_FEATURES_WEB_SEARCH: {{ .Values.openWebui.config.userPermissionsFeaturesWebSearch | quote }}
  USER_PERMISSIONS_FEATURES_IMAGE_GENERATION: {{ .Values.openWebui.config.userPermissionsFeaturesImageGeneration | quote }}
  USER_PERMISSIONS_FEATURES_API_KEYS: {{ .Values.openWebui.config.userPermissionsFeaturesApiKeys | quote }}

  # Admin
  ENABLE_ADMIN_EXPORT: {{ .Values.openWebui.config.enableAdminExport | quote }}
  ENABLE_ADMIN_CHAT_ACCESS: {{ .Values.openWebui.config.enableAdminChatAccess | quote }}
  ENABLE_ADMIN_WORKSPACE_CONTENT_ACCESS: {{ .Values.openWebui.config.enableAdminWorkspaceContentAccess | quote }}
  BYPASS_ADMIN_ACCESS_CONTROL: {{ .Values.openWebui.config.bypassAdminAccessControl | quote }}
  SHOW_ADMIN_DETAILS: {{ .Values.openWebui.config.showAdminDetails | quote }}
  ENABLE_EVALUATION_ARENA_MODELS: {{ .Values.openWebui.config.enableEvaluationArenaModels | quote }}
  ENABLE_API_KEYS: {{ .Values.openWebui.config.enableApiKeys | quote }}
  ENABLE_IMAGE_GENERATION: {{ .Values.openWebui.config.enableImageGeneration | quote }}
  ENABLE_GOOGLE_DRIVE_INTEGRATION: {{ .Values.openWebui.config.enableGoogleDriveIntegration | quote }}

  # OneDrive Integration
  ENABLE_ONEDRIVE_INTEGRATION: {{ .Values.openWebui.config.enableOnedriveIntegration | quote }}
  ENABLE_ONEDRIVE_PERSONAL: {{ .Values.openWebui.config.enableOnedrivePersonal | quote }}
  ENABLE_ONEDRIVE_BUSINESS: {{ .Values.openWebui.config.enableOnedriveBusiness | quote }}
  {{- if .Values.openWebui.config.onedriveClientIdBusiness }}
  ONEDRIVE_CLIENT_ID_BUSINESS: {{ .Values.openWebui.config.onedriveClientIdBusiness | quote }}
  {{- end }}
  {{- if .Values.openWebui.config.onedriveSharepointUrl }}
  ONEDRIVE_SHAREPOINT_URL: {{ .Values.openWebui.config.onedriveSharepointUrl | quote }}
  {{- end }}
  {{- if .Values.openWebui.config.onedriveSharepointTenantId }}
  ONEDRIVE_SHAREPOINT_TENANT_ID: {{ .Values.openWebui.config.onedriveSharepointTenantId | quote }}
  {{- end }}

  # OneDrive Sync
  ENABLE_ONEDRIVE_SYNC: {{ .Values.openWebui.config.enableOnedriveSync | quote }}
  ONEDRIVE_SYNC_INTERVAL_MINUTES: {{ .Values.openWebui.config.onedriveSyncIntervalMinutes | quote }}
  ONEDRIVE_MAX_FILES_PER_SYNC: {{ .Values.openWebui.config.onedriveMaxFilesPerSync | quote }}
  ONEDRIVE_MAX_FILE_SIZE_MB: {{ .Values.openWebui.config.onedriveMaxFileSizeMb | quote }}

  # Source Permissions
  STRICT_SOURCE_PERMISSIONS: {{ .Values.openWebui.config.strictSourcePermissions | default "true" | quote }}

  BYPASS_MODEL_ACCESS_CONTROL: {{ .Values.openWebui.config.bypassModelAccessControl | quote }}

  # Audit Logging
  AUDIT_LOG_LEVEL: {{ .Values.openWebui.config.auditLogLevel | quote }}

  # User Archival
  ENABLE_USER_ARCHIVAL: {{ .Values.openWebui.config.enableUserArchival | quote }}
  DEFAULT_ARCHIVE_RETENTION_DAYS: {{ .Values.openWebui.config.defaultArchiveRetentionDays | quote }}
  ENABLE_AUTO_ARCHIVE_ON_SELF_DELETE: {{ .Values.openWebui.config.enableAutoArchiveOnSelfDelete | quote }}
  AUTO_ARCHIVE_RETENTION_DAYS: {{ .Values.openWebui.config.autoArchiveRetentionDays | quote }}

  # Telemetry
  SCARF_NO_ANALYTICS: {{ .Values.openWebui.config.scarfNoAnalytics | quote }}
  DO_NOT_TRACK: {{ .Values.openWebui.config.doNotTrack | quote }}
  ANONYMIZED_TELEMETRY: {{ .Values.openWebui.config.anonymizedTelemetry | quote }}

  # Custom Prompts
  {{- if .Values.openWebui.config.queryGenerationPromptTemplate }}
  QUERY_GENERATION_PROMPT_TEMPLATE: {{ .Values.openWebui.config.queryGenerationPromptTemplate | quote }}
  {{- end }}

  # OpenTelemetry Configuration
  {{- if .Values.openWebui.config.telemetry.otel.enabled }}
  ENABLE_OTEL: "true"
  ENABLE_OTEL_TRACES: {{ .Values.openWebui.config.telemetry.otel.traces | quote }}
  ENABLE_OTEL_METRICS: {{ .Values.openWebui.config.telemetry.otel.metrics | quote }}
  ENABLE_OTEL_LOGS: {{ .Values.openWebui.config.telemetry.otel.logs | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.openWebui.config.telemetry.otel.endpoint | quote }}
  OTEL_SERVICE_NAME: {{ .Values.openWebui.config.telemetry.otel.serviceName | quote }}
  OTEL_EXPORTER_OTLP_INSECURE: {{ .Values.openWebui.config.telemetry.otel.insecure | quote }}
  OTEL_TRACES_SAMPLER: {{ .Values.openWebui.config.telemetry.otel.sampler | quote }}
  OTEL_OTLP_SPAN_EXPORTER: {{ .Values.openWebui.config.telemetry.otel.protocol | quote }}
  {{- if .Values.openWebui.config.telemetry.otel.resourceAttributes }}
  OTEL_RESOURCE_ATTRIBUTES: {{ .Values.openWebui.config.telemetry.otel.resourceAttributes | quote }}
  {{- end }}
  {{- end }}
{{- end }}
